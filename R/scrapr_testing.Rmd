---
title: "TESTING Ais_scrape APPROACHES"
author: "Sean Goral"
date: "10/20/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(rvest)
library(RCurl)
library(XML)
library(readr)
#library(magicfor)               

```

```{r, BASIC COLUMN SETUP FROM read.R}

 ais_col_types <- cols(
    X1 = col_character(),
    X2 = col_character(),
    X3 = col_character(),
    X4 = col_double(),
    X5 = col_double(),
    X6 = col_character(),
    X7 = col_character(),
    X8 = col_character(),
    X9 = col_character(),
    X10 = col_double(),
    X11 = col_double(),
    X12 = col_double(),
    X13 = col_double(),
    X14 = col_double(),
    X15 = col_double(),
    X16 = col_double(),
    X17 = col_character(),
    X18 = col_double(),
    X19 = col_double(),
    X20 = col_double(),
    X21 = col_double(),
    X22 = col_double(),
    X23 = col_double(),
    X24 = col_double(),
    X25 = col_double()
  )

```

Scrape a day of AIS DATA into DF

```{r, Extract AIS data: 1 day}

hours.list = c(0:23)
hours.list_1 = sprintf('%02d', hours.list)

AIS_text = lapply(paste0('https://ais.sbarc.org/logs_delimited/2019/190101/AIS_SBARC_190101-', hours.list_1,'.txt'),
                function(url){
                  url %>% 
                    read_delim(";", col_names = sprintf("X%d", 1:25), col_types = ais_col_types)
                  
                })

DF = do.call(rbind.data.frame, AIS_text)

```


```{r, GET AIS NUMBERS}
list = list()

for(h in 2018:2020) {
    h1 = sprintf('%02d', h)
    urls = paste0("https://ais.sbarc.org/logs_delimited/", h1, "/")
   
    html = getURL(urls)
  
    doc = htmlParse(html, asText = TRUE) %>%
    xpathSApply("//a", xmlValue) %>% 
    gsub("[^0-9]", "", .) %>% 
    cat(paste())
    
  }
#needs to write into list... or something

```


```{r, 2019 MANUAL NUMBER ENTRY}

trip.list = c(190101:191016)
trip.list_1 = sprintf("%d", trip.list)

try(
  lapply(paste0('https://ais.sbarc.org/logs_delimited/2019/', trip.list, '/AIS_SBARC_', trip.list,'-',hours.list_1,'.txt'),
                function(url1){
                  url1 %>% 
                    read_delim(";", col_names = sprintf("X%d", 1:25), col_types = ais_col_types)
                  
                }))


#url issue
```

```{r, for loop, manual number entry}

for (i in 180101:181016) {
  for (j in 0:23) {
  #ERROR HANDLING
  possibleError <- tryCatch(
      thing(),
      error=function(e) e
  )

  if(inherits(possibleError, "error")) next

  #REAL WORK
  
  i1 = sprintf('%d', i)
  j1 =sprintf('%02d', j)
  url1 = paste0("https://ais.sbarc.org/logs_delimited/2018/", i1,"/AIS_SBARC_", i1,"-", j1,".txt")
   data0 = read_html(url1, "pre") %>%
     html_text() %>% 
     read_delim(";", col_names = sprintf("X%d", 1:25), col_types = ais_col_types)
   
}
  }#end for

```

