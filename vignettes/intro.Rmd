---
title: "Introduction"
author: "Ben Best"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning = F,
  message = F,
  eval = T
)
```

## Load Santa Barbara AIS Ship Data

And get top ten vessels with data.

```{r}
library(tidyverse)
library(shipr)
# devtools::install_local(force=T)
# devtools::document()
# devtools::load_all()

data(sbais)

sbais %>% 
  group_by(name) %>% 
  summarize(n = n()) %>% 
  arrange(desc(n)) %>% 
  head(20) %>% 
  DT::datatable()
```


## Analyze Single Ship Data

```{r}
ship_name <- "NAUTILUS"
segs <- ship_segments(sbais, ship_name)

# look at ship segments
hist(segs$seg_kmhr)
summary(segs$seg_kmhr)
which(segs$seg_kmhr>100)
```

## Map Single Ship Line Segments with Speed

```{r}
map_ship_segments(segs)
```

## Breakdown Ship Speeds based on Compliance Threshold

```{r}
lims <- ship_limits(segs, limit_knots = 10, ship_name)

# show limits table without geometry
lims %>% 
  st_set_geometry(NULL)
```

## Gauge

```{r}
pct_dist_ok <- lims %>% 
  filter(label == "<= 10 knots") %>% 
  pull(pct_dist)

ship_gauge(pct_dist_ok)
```

## Value Box

```{r}
ship_box(pct_dist_ok)
```

## TODO: Next

1. Filter based on shipping lane area. Where are lanes shapefile or larger area to be defined as recommended slowdown area? 
    
    - [cajablo/cargo_AIS_tracks: 02_clean-AIS-data-ClassA.R#L102](https://github.com/cajablo/cargo_AIS_tracks/blob/master/02_clean-AIS-data-ClassA.R#L102):
      
      ```r
      lanes <- readOGR("C:/Users/Caroline/Desktop/Caroline ArcGIS/shipping_lanes","shipping_lanes_combined")
      ```

1. Compare average vessel speed inside and outside the slowdown area.

1. Convert km per hour (`kmhr`) to knots in segment outputs.

1. Loop through rendering all ship cards using parameterized ship_card.Rmd

1. Create directory page to ship cards and summary table of ship stats.

1. Relate ships to organizations.

1. Provide overview statistics for study area.
